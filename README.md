# wt-campaign-indexer

Reusable tooling for building a **wind tunnel campaign indexer**. The current milestone (`v0`) focuses on project scaffolding plus a production-ready CLI that creates shortened LabVIEW `.lvm` fixtures around trigger/burst events.

## Campaign folder shape (target)

A campaign is expected to look like:

```text
<campaign_root>/
  FST1387/
  FST1388/
  ...
  FST1391/
    FST_1391.lvm
    schlieren/
      run_C001H001S0001/
        *.cihx
    plif/
      run_C001H001S0001/
        *.cihx
    tracking/
      run_C001H001S0001/
        *.cihx
    piv/
      run_.../
        *.cihx
    kulite/
      *.csv
    readme.txt
```

Each `FST####` directory represents one facility test and may contain multiple diagnostics.

## Installation / development setup

This repository uses **uv** + `pyproject.toml`.

```bash
uv pip install -e ".[dev]"
```

## CLI: create shortened LVM fixture

Command:

```bash
wtt-make-lvm-fixture \
  --input /path/to/FST_1391.lvm \
  --output examples/dummy_campaign/FST1391/FST_1391_fixture.lvm \
  --trigger-channel Voltage \
  --burst-channel PLEN-PT \
  --header-row-index 23 \
  --pre-ms 200 \
  --post-ms 300 \
  --decimate 5 \
  --write-metadata-json examples/dummy_campaign/FST1391/FST_1391_fixture.json
```

### Behavior

- Preserves all pre-data header lines through the detected header row.
- Detects trigger candidates from `trigger-channel` using rolling-mean + gradient peaks.
- Detects burst index from `burst-channel` using rolling-mean + gradient argmax.
- If several trigger candidates are strong, chooses the one nearest the burst index.
- Writes a shortened TSV `.lvm`-like file that remains readable by `pandas.read_csv`.
- Keeps all columns in original order.
- Optional metadata JSON captures inferred `fs_hz`, selected indices, window, channels, and decimation.

## Building a dummy campaign under `examples/`

1. Copy a small set of real `FST####/` folders into `examples/dummy_campaign/`.
2. Replace each full `FST_####.lvm` with a fixture generated by `wtt-make-lvm-fixture`.
3. Keep tiny `.cihx` metadata files in diagnostic `run_*` directories.
4. Optionally keep one tiny non-camera CSV diagnostic (for future rate inference tests).

A placeholder dummy campaign folder is included at:

```text
examples/dummy_campaign/FST1391/
```

## Quality checks

```bash
ruff check .
black --check .
pytest
```

## CI

GitHub Actions is configured to run lint, format checks, and tests on every push/PR.
